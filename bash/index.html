<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Lorenzo Salvadorini aka LoreLLo">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Bash - Lorello technical notes</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Bash";
    var mkdocs_page_input_path = "bash.md";
    var mkdocs_page_url = "/bash/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Lorello technical notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../api-auth/">Api auth</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../atom/">Atom</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Bash</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#bashism">Bashism</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#checking-strings">Checking strings</a></li>
        
            <li><a class="toctree-l3" href="#loops">Loops</a></li>
        
            <li><a class="toctree-l3" href="#process-cli-options">Process CLI options</a></li>
        
            <li><a class="toctree-l3" href="#bash-dates">Bash dates</a></li>
        
            <li><a class="toctree-l3" href="#builtin-bashism-instead-of-external-binaries">Builtin bashism instead of external binaries</a></li>
        
            <li><a class="toctree-l3" href="#vs">[[ vs [</a></li>
        
            <li><a class="toctree-l3" href="#debug">Debug</a></li>
        
            <li><a class="toctree-l3" href="#some-style">Some style</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../bind/">Bind</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../centos/">Centos</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../changelog/">Changelog</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cisco/">Cisco</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../docker/">Docker</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../git/">Git</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../ip/">Ip</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../linux-networking/">Linux networking</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../lvm/">Lvm</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../macosx/">Macosx</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../mongodb/">Mongodb</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../mysql/">Mysql</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../nginx/">Nginx</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../octohost/">Octohost</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../openssl/">Openssl</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../php/">Php</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../poormanvpn/">Poormanvpn</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../postfix/">Postfix</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../puppet/">Puppet</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../raid/">Raid</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../services/">Services</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../systemd/">Systemd</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../xenserver/">Xenserver</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../zfs/">Zfs</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Lorello technical notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Bash</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/lorello/lorello.github.io/edit/master/docs/bash.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="bashism">Bashism</h1>
<p>I use a little library to have a common set of utilities out of the box in my
bash scripts, it can be retrieved at https://github.com/lorello/lib.sh</p>
<h2 id="checking-strings">Checking strings</h2>
<pre><code># -z (string length is zero) and -n (string length is not zero) are
# preferred over testing for an empty string
if [[ -z "${my_var}" ]]; then
    do_something
fi
</code></pre>
<h2 id="loops">Loops</h2>
<p>Loop on a rows of a text file</p>
<pre><code>#!/bin/sh
list=/tmp/blacklists/porn/domains
cat $list | while read domains
do
    echo $domains
done
</code></pre>
<p>Loop on a counter</p>
<pre><code>counter=1
while (( $counter &lt; 10 ))
do
    echo $counter
    ((counter++))
done
</code></pre>
<p>Loop on a list of items</p>
<pre><code>modules=(json httpserver jshint)
for module in "${modules[@]}"; do
    npm install -g "$module"
done
</code></pre>
<p>Looping </p>
<pre><code>for ((i = 0; i &lt; n; i++)); do
    ...
done
</code></pre>
<h2 id="process-cli-options">Process CLI options</h2>
<pre><code>aaa=''
bbb=''
ccc=''

while [ $# -gt 0 ]
do
  case $1 in
    -h) print_help ;;
    --help) print_help ;;
    -a) aaa=$2 ; shift 2 ;;
    -b) bbb=$2 ; shift 2 ;;
    -c) ccc=$2 ; shift 2 ;;
    *) shift 1 ;;
  esac
done
</code></pre>
<p>Another way</p>
<pre><code>verbose='false'
aflag=''
bflag=''
files=''
while getopts 'abf:v' flag; do
  case "${flag}" in
    a) aflag='true' ;;
    b) bflag='true' ;;
    f) files="${OPTARG}" ;;
    v) verbose='true' ;;
    *) error "Unexpected option ${flag}" ;;
  esac
done
</code></pre>
<p>A more advanced options is to use [https://github.com/nk412/optparse|optparse]</p>
<h2 id="bash-dates">Bash dates</h2>
<p>A simple date useful for filenaming: YYYY-MM-DD</p>
<pre><code>$(date +%F)
</code></pre>
<p>A full datetime</p>
<pre><code>$(date +%F-%T)
</code></pre>
<h2 id="builtin-bashism-instead-of-external-binaries">Builtin bashism instead of external binaries</h2>
<pre><code>fqdn='computer1.daveeddy.com'

IFS=. read -r hostname domain tld &lt;&lt;&lt; "$fqdn"
echo "$hostname is in $domain.$tld"
# =&gt; "computer1 is in daveeddy.com"
</code></pre>
<h2 id="vs">[[ vs [</h2>
<p>There is also the <a href="http://mywiki.wooledge.org/BashFAQ/031">long version</a></p>
<pre><code>[[ a &gt; b ]]

[[ -n $var &amp;&amp; -f $var ]] &amp;&amp; echo "$var is a file"

[[ $var = img* &amp;&amp; ($var = *.png || $var = *.jpg) ]] &amp;&amp; \
    echo "$var starts with img and ends with .jpg or .png"

[[ $name = a* ]] || echo "name does not start with an 'a': $name"

[[ $(date) =~ ^Fri\ ...\ 13 ]] &amp;&amp; echo "It's Friday the 13th!"
</code></pre>
<h2 id="debug">Debug</h2>
<p>The following code uses the DEBUG trap to inform the user about what command is about to be executed and wait for his confirmation do to so. Put this code in your script, at the location you wish to begin stepping:</p>
<pre><code>trap '(read -p "[$BASH_SOURCE:$LINENO] $BASH_COMMAND?")' DEBUG
</code></pre>
<p>Give va value to TRACE to add -x flag to execution:</p>
<pre><code>[[ "$TRACE" ]] &amp;&amp; set -x
</code></pre>
<h2 id="some-style">Some style</h2>
<pre><code>meaningful_function_names() { ... }


addition=$((${X} + ${Y}))
substitution="${string/#foo/bar}"
</code></pre>
<p>Case formatting</p>
<pre><code>case "${expression}" in
  a)
    variable="..."
    some_command "${variable}" "${other_expr}" ...
    ;;
  absolute)
    actions="relative"
    another_command "${actions}" "${other_expr}" ...
    ;;
  *)
    error "Unexpected expression '${expression}'"
    ;;
esac
</code></pre>
<p>Sources: <a href="https://google.github.io/styleguide/shell.xml">Google</a>, 
<a href="https://github.com/progrium/bashstyle">Progrium</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../bind/" class="btn btn-neutral float-right" title="Bind">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../atom/" class="btn btn-neutral" title="Atom"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>It's all free, copy and use at your own risk</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/lorello/lorello.github.io/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../atom/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../bind/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
